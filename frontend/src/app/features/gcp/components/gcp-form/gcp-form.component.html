<div class="gcp-container" *ngIf="config$ | async as config">
  <!-- Header -->
  <div class="gcp-header">
    <h1>{{ config.module.display.title }}</h1>
    <p class="subtitle">{{ config.module.display.subtitle }}</p>
    <mat-progress-bar 
      mode="determinate" 
      [value]="progress$ | async">
    </mat-progress-bar>
  </div>

  <!-- Current Section -->
  <mat-card class="section-card" *ngIf="currentSection$ | async as section">
    <mat-card-header>
      <mat-card-title>{{ section.title }}</mat-card-title>
      <mat-card-subtitle *ngIf="section.description">
        {{ section.description }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Info section (intro, etc.) -->
      <div *ngIf="section.type === 'info'" class="info-section">
        <div *ngFor="let paragraph of section.content">
          <p>{{ paragraph }}</p>
        </div>
        
        <div class="actions" *ngIf="section.actions">
          <button 
            mat-raised-button 
            *ngFor="let action of section.actions"
            (click)="onNext()"
            color="primary">
            {{ action.label }}
          </button>
        </div>
      </div>

      <!-- Question section -->
      <form 
        [formGroup]="form" 
        *ngIf="section.type !== 'info' && currentSectionFields.length > 0">
        <formly-form
          [form]="form"
          [fields]="currentSectionFields"
          [model]="model"
          [options]="options">
        </formly-form>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <!-- Previous button -->
      <button 
        mat-button 
        (click)="onPrevious()"
        [disabled]="!(canGoPrevious$ | async)">
        <mat-icon>arrow_back</mat-icon>
        Previous
      </button>

      <!-- Next button -->
      <button 
        mat-raised-button 
        color="primary"
        (click)="onNext()"
        [disabled]="!(canGoNext$ | async) || !form.valid"
        *ngIf="!(isLastSection$ | async)">
        Next
        <mat-icon>arrow_forward</mat-icon>
      </button>

      <!-- Submit button -->
      <button 
        mat-raised-button 
        color="primary"
        (click)="onSubmit()"
        [disabled]="!form.valid || (submitting$ | async)"
        *ngIf="isLastSection$ | async">
        <mat-icon>check_circle</mat-icon>
        {{ (submitting$ | async) ? 'Submitting...' : 'Get Recommendation' }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>

<!-- Loading state -->
<div class="loading-state" *ngIf="!(config$ | async)">
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  <p>Loading assessment...</p>
</div>
